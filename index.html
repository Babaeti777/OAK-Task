<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Eisenhower Matrix Planner</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            color-scheme: light dark;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            --bg: #f5f7fb;
            --card: #ffffff;
            --card-muted: #f8fafc;
            --text: #111827;
            --text-muted: #6b7280;
            --border: #d3d9e3;
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --danger: #dc2626;
            --shadow: 0 18px 40px rgba(15, 23, 42, 0.12);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            min-height: 100vh;
            background: var(--bg);
            color: var(--text);
        }

        body {
            display: flex;
            justify-content: center;
            padding: clamp(1.5rem, 3vw, 3rem);
        }

        main {
            width: min(1120px, 100%);
            display: grid;
            gap: clamp(1.5rem, 3vw, 2.5rem);
        }

        header {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: clamp(2.25rem, 4vw, 3rem);
            font-weight: 700;
        }

        header p {
            margin: 0;
            color: var(--text-muted);
            font-size: clamp(1rem, 2vw, 1.1rem);
        }

        section {
            background: var(--card);
            border-radius: 20px;
            padding: clamp(1.25rem, 2.5vw, 2rem);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: var(--shadow);
        }

        section h2 {
            margin: 0 0 1rem;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        label {
            display: flex;
            flex-direction: column;
            gap: 0.45rem;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }

        input,
        select,
        textarea {
            padding: 0.7rem 0.85rem;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card-muted);
            color: inherit;
            font: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: rgba(37, 99, 235, 0.7);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.18);
        }

        textarea {
            resize: vertical;
            min-height: 90px;
        }

        .button {
            appearance: none;
            border: none;
            border-radius: 12px;
            padding: 0.85rem 1.4rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
            color: #fff;
            background: var(--primary);
        }

        .button:hover {
            transform: translateY(-1px);
            background: var(--primary-dark);
            box-shadow: 0 16px 30px rgba(37, 99, 235, 0.25);
        }

        .button.secondary {
            background: rgba(37, 99, 235, 0.12);
            color: var(--primary-dark);
            box-shadow: none;
        }

        .button.secondary:hover {
            background: rgba(37, 99, 235, 0.2);
        }

        .matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: clamp(1rem, 2vw, 1.5rem);
        }

        .quadrant {
            background: var(--card);
            border-radius: 18px;
            padding: 1.1rem;
            border: 1px solid rgba(148, 163, 184, 0.24);
            min-height: 280px;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .quadrant[data-dropping="true"] {
            border-color: rgba(37, 99, 235, 0.5);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
        }

        .quadrant header {
            align-items: flex-start;
            text-align: left;
            gap: 0.2rem;
        }

        .quadrant header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .quadrant header p {
            margin: 0;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .task-list {
            display: grid;
            gap: 0.8rem;
        }

        .task {
            background: var(--card-muted);
            border-radius: 14px;
            padding: 0.85rem;
            border: 1px solid transparent;
            box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.2);
            display: grid;
            gap: 0.6rem;
            cursor: grab;
        }

        .task:active {
            cursor: grabbing;
        }

        .task h4 {
            margin: 0;
            font-size: 1rem;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-button {
            border: none;
            border-radius: 10px;
            padding: 0.45rem 0.65rem;
            font: inherit;
            cursor: pointer;
            background: rgba(37, 99, 235, 0.08);
            color: var(--primary-dark);
        }

        .icon-button:hover {
            background: rgba(37, 99, 235, 0.18);
        }

        .icon-button.danger {
            color: var(--danger);
            background: rgba(220, 38, 38, 0.1);
        }

        .icon-button.danger:hover {
            background: rgba(220, 38, 38, 0.2);
        }

        .timer-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            align-items: center;
        }

        .timer-display {
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            font-weight: 700;
            text-align: center;
        }

        .timer-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
        }

        .timer-settings {
            display: grid;
            gap: 0.85rem;
        }

        .status {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --card: #111c32;
                --card-muted: #1b2540;
                --text: #e2e8f0;
                --text-muted: #94a3b8;
                --border: #1e293b;
                --shadow: none;
            }

            .task {
                box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.25);
            }
        }
    </style>
</head>
<body>
    <main>
        <header>
            <h1>Eisenhower Matrix Planner</h1>
            <p>Capture tasks, drag them between quadrants, and stay focused with the built-in timer.</p>
        </header>

        <section aria-labelledby="task-form-title">
            <h2 id="task-form-title">Add a task</h2>
            <form id="task-form">
                <div class="form-grid">
                    <label>Task title
                        <input id="task-title" name="title" type="text" autocomplete="off" required placeholder="Follow up with customer" />
                    </label>
                    <label>Due date
                        <input id="task-date" name="date" type="date" />
                    </label>
                    <label>Urgency
                        <select id="task-urgent" name="urgent">
                            <option value="urgent">Urgent</option>
                            <option value="not-urgent">Not urgent</option>
                        </select>
                    </label>
                    <label>Importance
                        <select id="task-important" name="important">
                            <option value="important">Important</option>
                            <option value="not-important">Not important</option>
                        </select>
                    </label>
                </div>
                <label>Notes
                    <textarea id="task-notes" name="notes" placeholder="Add context, resources, or the next step"></textarea>
                </label>
                <div style="margin-top:1.2rem; display:flex; gap:0.75rem; flex-wrap:wrap;">
                    <button class="button" type="submit">Save task</button>
                    <button class="button secondary" type="reset">Clear</button>
                </div>
            </form>
        </section>

        <section aria-labelledby="matrix-title">
            <h2 id="matrix-title">Your matrix</h2>
            <div class="matrix" id="matrix">
                <article class="quadrant" data-quadrant="urgent-important">
                    <header>
                        <h3>Do first</h3>
                        <p>Urgent &amp; Important</p>
                    </header>
                    <div class="task-list" aria-live="polite"></div>
                </article>
                <article class="quadrant" data-quadrant="not-urgent-important">
                    <header>
                        <h3>Schedule</h3>
                        <p>Not urgent &amp; Important</p>
                    </header>
                    <div class="task-list" aria-live="polite"></div>
                </article>
                <article class="quadrant" data-quadrant="urgent-not-important">
                    <header>
                        <h3>Delegate</h3>
                        <p>Urgent &amp; Not important</p>
                    </header>
                    <div class="task-list" aria-live="polite"></div>
                </article>
                <article class="quadrant" data-quadrant="not-urgent-not-important">
                    <header>
                        <h3>Limit</h3>
                        <p>Not urgent &amp; Not important</p>
                    </header>
                    <div class="task-list" aria-live="polite"></div>
                </article>
            </div>
        </section>

        <section aria-labelledby="timer-title">
            <h2 id="timer-title">Focus timer</h2>
            <div class="timer-grid">
                <div class="timer-display" aria-live="polite" id="timer-display">25:00</div>
                <div class="timer-controls">
                    <button class="button" type="button" id="timer-start">Start</button>
                    <button class="button secondary" type="button" id="timer-pause">Pause</button>
                    <button class="button secondary" type="button" id="timer-reset">Reset</button>
                </div>
                <form class="timer-settings" id="timer-settings">
                    <label>Focus length (minutes)
                        <input type="number" id="focus-minutes" min="1" max="120" value="25" />
                    </label>
                    <label>Break length (minutes)
                        <input type="number" id="break-minutes" min="1" max="60" value="5" />
                    </label>
                    <label>
                        Auto-start break
                        <select id="auto-break">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </label>
                </form>
                <p class="status" id="timer-status">Set a custom duration, then press start.</p>
            </div>
        </section>
    </main>

    <template id="task-template">
        <article class="task" draggable="true">
            <div class="task-content">
                <h4 data-field="title"></h4>
                <p data-field="notes" class="task-notes" hidden></p>
                <div class="task-meta">
                    <span data-field="date" hidden></span>
                    <span data-field="created"></span>
                </div>
            </div>
            <div class="task-actions">
                <button class="icon-button" data-action="toggle-notes" type="button">Details</button>
                <button class="icon-button" data-action="edit" type="button">Edit</button>
                <button class="icon-button danger" data-action="delete" type="button">Delete</button>
            </div>
        </article>
    </template>

    <dialog id="task-dialog">
        <form method="dialog" id="dialog-form">
            <h2>Edit task</h2>
            <label>Task title
                <input type="text" name="title" required />
            </label>
            <label>Due date
                <input type="date" name="date" />
            </label>
            <label>Notes
                <textarea name="notes"></textarea>
            </label>
            <label>Urgency
                <select name="urgent">
                    <option value="urgent">Urgent</option>
                    <option value="not-urgent">Not urgent</option>
                </select>
            </label>
            <label>Importance
                <select name="important">
                    <option value="important">Important</option>
                    <option value="not-important">Not important</option>
                </select>
            </label>
            <menu style="display:flex; gap:0.5rem; margin-top:1rem;">
                <button class="button secondary" value="cancel">Cancel</button>
                <button class="button" value="confirm">Save</button>
            </menu>
        </form>
    </dialog>

    <script>
        const STORAGE_KEY = "eisenhower-matrix-tasks";

        const quadrants = {
            "urgent-important": "Do first",
            "not-urgent-important": "Schedule",
            "urgent-not-important": "Delegate",
            "not-urgent-not-important": "Limit",
        };

        const form = document.getElementById("task-form");
        const template = document.getElementById("task-template");
        const dialog = document.getElementById("task-dialog");
        const dialogForm = document.getElementById("dialog-form");
        const matrix = document.getElementById("matrix");

        const state = {
            tasks: loadTasks(),
            editingId: null,
        };

        function uuid() {
            return crypto.randomUUID ? crypto.randomUUID() : `${Date.now()}-${Math.random().toString(16).slice(2)}`;
        }

        function loadTasks() {
            try {
                const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
                if (!Array.isArray(stored)) return [];
                return stored;
            } catch (error) {
                console.error("Failed to parse stored tasks", error);
                return [];
            }
        }

        function persist() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state.tasks));
        }

        function quadrantKey(urgent, important) {
            return `${urgent === "urgent" ? "urgent" : "not-urgent"}-${important === "important" ? "important" : "not-important"}`;
        }

        function createTask(data) {
            return {
                id: uuid(),
                title: data.title.trim(),
                date: data.date || "",
                notes: data.notes.trim(),
                urgent: data.urgent,
                important: data.important,
                createdAt: new Date().toISOString(),
            };
        }

        function updateTask(id, updater) {
            const idx = state.tasks.findIndex((task) => task.id === id);
            if (idx === -1) return;
            state.tasks[idx] = { ...state.tasks[idx], ...updater };
            persist();
            render();
        }

        function deleteTask(id) {
            state.tasks = state.tasks.filter((task) => task.id !== id);
            persist();
            render();
        }

        function render() {
            const lists = matrix.querySelectorAll(".task-list");
            lists.forEach((list) => (list.innerHTML = ""));

            const formatter = new Intl.DateTimeFormat(undefined, {
                year: "numeric",
                month: "short",
                day: "numeric",
            });

            const relative = new Intl.RelativeTimeFormat(undefined, { numeric: "auto" });
            const now = Date.now();

            state.tasks.forEach((task) => {
                const fragment = template.content.cloneNode(true);
                const element = fragment.querySelector(".task");
                element.dataset.id = task.id;
                element.dataset.quadrant = quadrantKey(task.urgent, task.important);

                const title = fragment.querySelector('[data-field="title"]');
                title.textContent = task.title;

                const notes = fragment.querySelector('[data-field="notes"]');
                if (task.notes) {
                    notes.textContent = task.notes;
                    notes.hidden = false;
                }

                const dateField = fragment.querySelector('[data-field="date"]');
                if (task.date) {
                    const due = new Date(task.date);
                    dateField.textContent = `Due ${formatter.format(due)} (${relativeTime(relative, due.getTime() - now)})`;
                    dateField.hidden = false;
                }

                const createdField = fragment.querySelector('[data-field="created"]');
                const created = new Date(task.createdAt);
                createdField.textContent = `Added ${formatter.format(created)}`;

                attachTaskEvents(element, task);
                const list = matrix.querySelector(`.quadrant[data-quadrant="${element.dataset.quadrant}"] .task-list`);
                list.appendChild(fragment);
            });
        }

        function relativeTime(formatter, diff) {
            const minutes = Math.round(diff / (60 * 1000));
            const hours = Math.round(diff / (60 * 60 * 1000));
            const days = Math.round(diff / (24 * 60 * 60 * 1000));

            if (Math.abs(minutes) < 60) return formatter.format(minutes, "minute");
            if (Math.abs(hours) < 24) return formatter.format(hours, "hour");
            return formatter.format(days, "day");
        }

        function attachTaskEvents(element, task) {
            element.addEventListener("dragstart", handleDragStart);
            element.addEventListener("dragend", handleDragEnd);

            element.querySelector('[data-action="toggle-notes"]').addEventListener("click", () => {
                const notes = element.querySelector(".task-notes");
                if (!notes) return;
                notes.hidden = !notes.hidden;
            });

            element.querySelector('[data-action="delete"]').addEventListener("click", () => {
                if (confirm("Delete this task?")) {
                    deleteTask(task.id);
                }
            });

            element.querySelector('[data-action="edit"]').addEventListener("click", () => {
                openDialog(task);
            });
        }

        form.addEventListener("submit", (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const task = createTask(Object.fromEntries(formData));
            state.tasks.push(task);
            persist();
            render();
            form.reset();
            form.querySelector("input[name='title']").focus();
        });

        form.addEventListener("reset", () => {
            requestAnimationFrame(() => form.querySelector("input[name='title']").focus());
        });

        dialog.addEventListener("close", () => {
            state.editingId = null;
            dialogForm.reset();
        });

        dialogForm.addEventListener("submit", (event) => {
            event.preventDefault();
            if (!state.editingId) return;
            const formData = new FormData(dialogForm);
            updateTask(state.editingId, Object.fromEntries(formData));
            dialog.close();
        });

        function openDialog(task) {
            state.editingId = task.id;
            dialogForm.title.value = task.title;
            dialogForm.date.value = task.date;
            dialogForm.notes.value = task.notes;
            dialogForm.urgent.value = task.urgent;
            dialogForm.important.value = task.important;
            dialog.showModal();
        }

        let draggedTask = null;

        function handleDragStart(event) {
            draggedTask = event.currentTarget;
            event.dataTransfer.effectAllowed = "move";
            event.dataTransfer.setData("text/plain", draggedTask.dataset.id);
            requestAnimationFrame(() => {
                draggedTask.classList.add("dragging");
            });
        }

        function handleDragEnd() {
            if (draggedTask) {
                draggedTask.classList.remove("dragging");
                draggedTask = null;
            }
        }

        matrix.querySelectorAll(".quadrant").forEach((quadrant) => {
            quadrant.addEventListener("dragover", (event) => {
                event.preventDefault();
                event.dataTransfer.dropEffect = "move";
                quadrant.dataset.dropping = "true";
            });

            quadrant.addEventListener("dragleave", () => {
                quadrant.dataset.dropping = "false";
            });

            quadrant.addEventListener("drop", (event) => {
                event.preventDefault();
                quadrant.dataset.dropping = "false";
                const id = event.dataTransfer.getData("text/plain");
                const key = quadrant.dataset.quadrant;
                const urgent = key.startsWith("urgent") ? "urgent" : "not-urgent";
                const important = key.endsWith("important") ? "important" : "not-important";
                updateTask(id, { urgent, important });
            });
        });

        render();

        /** Timer logic */
        const display = document.getElementById("timer-display");
        const startButton = document.getElementById("timer-start");
        const pauseButton = document.getElementById("timer-pause");
        const resetButton = document.getElementById("timer-reset");
        const status = document.getElementById("timer-status");
        const focusInput = document.getElementById("focus-minutes");
        const breakInput = document.getElementById("break-minutes");
        const autoBreak = document.getElementById("auto-break");

        const timerState = {
            phase: "focus",
            remaining: minutesToMs(Number(focusInput.value)),
            timeout: null,
            end: null,
        };

        function minutesToMs(minutes) {
            return Math.max(1, minutes) * 60 * 1000;
        }

        function formatTime(ms) {
            const totalSeconds = Math.max(0, Math.ceil(ms / 1000));
            const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
            const seconds = String(totalSeconds % 60).padStart(2, "0");
            return `${minutes}:${seconds}`;
        }

        function setStatus(message) {
            status.textContent = message;
        }

        function updateDisplay() {
            const remaining = timerState.end ? Math.max(0, timerState.end - Date.now()) : timerState.remaining;
            display.textContent = formatTime(remaining);
        }

        function tick() {
            updateDisplay();
            if (!timerState.end) return;
            if (Date.now() >= timerState.end) {
                completePhase();
            } else {
                timerState.timeout = requestAnimationFrame(tick);
            }
        }

        function startTimer() {
            if (timerState.end) return;
            timerState.end = Date.now() + timerState.remaining;
            timerState.timeout = requestAnimationFrame(tick);
            setStatus(`Focus ${timerState.phase === "focus" ? "session" : "break"} in progress.`);
        }

        function pauseTimer() {
            if (!timerState.end) return;
            timerState.remaining = Math.max(0, timerState.end - Date.now());
            cancelAnimationFrame(timerState.timeout);
            timerState.timeout = null;
            timerState.end = null;
            setStatus("Paused. Press start to resume.");
        }

        function resetTimer() {
            cancelAnimationFrame(timerState.timeout);
            timerState.timeout = null;
            timerState.end = null;
            timerState.phase = "focus";
            timerState.remaining = minutesToMs(Number(focusInput.value));
            display.textContent = formatTime(timerState.remaining);
            setStatus("Timer reset. Configure lengths and press start.");
        }

        function completePhase() {
            cancelAnimationFrame(timerState.timeout);
            timerState.timeout = null;
            timerState.end = null;

            if (timerState.phase === "focus") {
                setStatus("Focus complete! Take a break.");
                timerState.phase = "break";
                timerState.remaining = minutesToMs(Number(breakInput.value));
                display.textContent = formatTime(timerState.remaining);
                if (autoBreak.value === "true") {
                    startTimer();
                }
            } else {
                setStatus("Break over. Ready for the next focus block.");
                timerState.phase = "focus";
                timerState.remaining = minutesToMs(Number(focusInput.value));
                display.textContent = formatTime(timerState.remaining);
            }
        }

        startButton.addEventListener("click", () => {
            if (!timerState.end) {
                timerState.remaining = timerState.remaining || minutesToMs(Number(focusInput.value));
                startTimer();
            }
        });

        pauseButton.addEventListener("click", pauseTimer);
        resetButton.addEventListener("click", resetTimer);

        focusInput.addEventListener("change", () => {
            if (timerState.phase === "focus" && !timerState.end) {
                timerState.remaining = minutesToMs(Number(focusInput.value));
                display.textContent = formatTime(timerState.remaining);
                setStatus("Focus length updated.");
            }
        });

        breakInput.addEventListener("change", () => {
            if (timerState.phase === "break" && !timerState.end) {
                timerState.remaining = minutesToMs(Number(breakInput.value));
                display.textContent = formatTime(timerState.remaining);
                setStatus("Break length updated.");
            }
        });

        resetTimer();
    </script>
</body>
</html>
